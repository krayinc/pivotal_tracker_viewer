<h1 class="mb-4">エピック一覧</h1>

<p>エピックごとのストーリー数、受け入れ済み割合、ポイント合計を集計しています。エピックを選択するとストーリー一覧に絞り込みが適用されます。</p>

<section class="epics-summary">
  <div class="summary-card">
    <h2>総ストーリー数</h2>
    <p class="summary-value"><%= number_with_delimiter(@summary[:stories]) %></p>
    <p class="summary-sub">受け入れ済み <%= @summary[:accepted] %> 件</p>
  </div>
  <div class="summary-card">
    <h2>受け入れ進捗</h2>
    <div class="summary-progress">
      <div class="summary-progress__bar">
        <div class="summary-progress__fill" style="width: <%= epic_summary_progress(@summary) %>%"></div>
      </div>
      <span class="summary-progress__text"><%= @summary[:accepted] %> / <%= @summary[:stories] %></span>
    </div>
  </div>
  <div class="summary-card">
    <h2>ポイント合計</h2>
    <p class="summary-value"><%= @summary[:total_points] %> pt</p>
    <p class="summary-sub">Accepted: <%= @summary[:accepted_points] %> pt</p>
  </div>
</section>

<section class="epics-layout">
  <div class="epics-table-wrapper">
    <table class="epics-table">
      <thead>
        <tr>
          <th>エピック</th>
          <th>ストーリー数</th>
          <th>受け入れ済み</th>
          <th>進捗</th>
          <th>ポイント</th>
        </tr>
      </thead>
      <tbody>
        <% @epics.each do |epic| %>
          <tr>
            <td>
              <div class="epic-name">
                <%= link_to epic.name, stories_path(filter: { labels: [epic.label].compact }), data: { turbo_frame: "stories_list" } %>
                <% if epic.label.present? %>
                  <span class="epic-label">#<%= epic.label %></span>
                <% end %>
              </div>
            </td>
            <td class="metric"><%= epic.stories_count %></td>
            <td class="metric"><%= epic.accepted_count %></td>
            <td class="metric">
              <div class="progress-bar">
                <div class="progress-bar__fill" style="width: <%= epic_progress_percentage(epic) %>%"></div>
              </div>
              <span class="progress-text"><%= epic_progress_text(epic) %></span>
            </td>
            <td class="metric">
              <div><strong>Total:</strong> <%= epic.total_points || 0 %> pt</div>
              <div class="text-muted">Accepted: <%= epic.accepted_points || 0 %> pt</div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <aside class="epics-secondary">
    <h2>使い方</h2>
    <ol>
      <li>エピック名をクリックすると、そのラベルを持つストーリーに一覧が切り替わります。</li>
      <li>進捗バーは受け入れ済みストーリー数の割合を示します。</li>
      <li>ポイントはストーリーの estimate 合計です（未設定は 0 pt として集計）。</li>
    </ol>

    <%= link_to "ストーリー一覧に戻る", stories_path, class: "epics-back-link" %>
  </aside>
</section>
