<% provide(:title, t("epics.index.title")) %>

<h1 class="mb-4"><%= t("epics.index.title") %></h1>

<p><%= t("epics.index.description") %></p>

<section class="epics-summary">
  <div class="summary-card">
    <h2><%= t("epics.index.summary_total_stories") %></h2>
    <p class="summary-value"><%= number_with_delimiter(@summary[:stories]) %></p>
    <p class="summary-sub"><%= t("epics.index.summary_accepted", count: @summary[:accepted]) %></p>
  </div>
  <div class="summary-card">
    <h2><%= t("epics.index.summary_progress") %></h2>
    <div class="summary-progress">
      <div class="summary-progress__bar">
        <div class="summary-progress__fill" style="width: <%= epic_summary_progress(@summary) %>%"></div>
      </div>
      <span class="summary-progress__text"><%= @summary[:accepted] %> / <%= @summary[:stories] %></span>
    </div>
  </div>
  <div class="summary-card">
    <h2><%= t("epics.index.summary_points") %></h2>
    <p class="summary-value"><%= @summary[:total_points] %> pt</p>
    <p class="summary-sub"><%= t("epics.index.summary_points_detail", points: @summary[:accepted_points]) %></p>
  </div>
</section>

<section class="epics-layout">
  <div class="epics-table-wrapper">
    <table class="epics-table">
      <thead>
        <tr>
          <th><%= t("epics.index.table_epic") %></th>
          <th><%= t("epics.index.table_stories") %></th>
          <th><%= t("epics.index.table_accepted") %></th>
          <th><%= t("epics.index.table_progress") %></th>
          <th><%= t("epics.index.table_points") %></th>
        </tr>
      </thead>
      <tbody>
        <% @epics.each do |epic| %>
          <tr>
            <td>
              <div class="epic-name">
                <%= link_to epic.name, stories_path(filter: { labels: [epic.label].compact }), data: { turbo_frame: "stories_list" } %>
                <% if epic.label.present? %>
                  <span class="epic-label">#<%= epic.label %></span>
                <% end %>
              </div>
            </td>
            <td class="metric"><%= epic.stories_count %></td>
            <td class="metric"><%= epic.accepted_count %></td>
            <td class="metric">
              <div class="progress-bar">
                <div class="progress-bar__fill" style="width: <%= epic_progress_percentage(epic) %>%"></div>
              </div>
              <span class="progress-text"><%= epic_progress_text(epic) %></span>
            </td>
            <td class="metric">
              <div><strong><%= t("epics.index.points_total", points: epic.total_points || 0) %></strong></div>
              <div class="text-muted"><%= t("epics.index.points_accepted", points: epic.accepted_points || 0) %></div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <aside class="epics-secondary">
    <h2><%= t("epics.index.how_to") %></h2>
    <ol>
      <li><%= t("epics.index.how_to_1") %></li>
      <li><%= t("epics.index.how_to_2") %></li>
      <li><%= t("epics.index.how_to_3") %></li>
    </ol>

    <%= link_to t("common.back_to_stories"), stories_path, class: "epics-back-link" %>
  </aside>
</section>
