<% filter_params = local_assigns.fetch(:filter_params, {}) %>

<table class="table-auto w-full border-collapse mt-4">
  <thead>
    <tr class="text-left border-b">
      <th class="py-2 pr-4"><%= t("stories.list.title") %></th>
      <th class="py-2 pr-4"><%= t("stories.list.type") %></th>
      <th class="py-2 pr-4"><%= t("stories.list.state") %></th>
      <th class="py-2 pr-4"><%= t("stories.list.points") %></th>
      <th class="py-2 pr-4"><%= t("stories.list.epic") %></th>
    </tr>
  </thead>
  <tbody>
    <% stories.each do |story| %>
      <tr class="border-b">
        <td class="py-2 pr-4"><%= link_to story.title, story_path(story), data: { turbo_frame: "story_detail" } %></td>
        <td class="py-2 pr-4"><%= story.story_type.presence || t("common.not_available") %></td>
        <td class="py-2 pr-4"><%= story.current_state.presence || t("common.not_available") %></td>
        <td class="py-2 pr-4"><%= story.estimate.presence || t("common.not_available") %></td>
        <td class="py-2 pr-4"><%= story.epic&.name || t("common.not_available") %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if stories.empty? %>
  <p class="mt-4"><%= t("stories.list.empty") %></p>
<% elsif next_page %>
  <div class="flex flex-col items-center gap-2 py-6">
    <div class="text-sm text-gray-500"><%= t("stories.pagination.auto_load_hint") %></div>
    <%= link_to t("stories.pagination.load_more"), stories_path(page: next_page, filter: filter_params),
                class: "px-4 py-2 bg-gray-800 text-white rounded",
                data: { turbo_frame: "stories_list", "infinite-scroll-target": "link" } %>
    <div class="text-sm text-gray-400" data-infinite-scroll-target="sentinel"><%= t("stories.pagination.loading") %></div>
  </div>
<% else %>
  <p class="py-6 text-center text-gray-500"><%= t("stories.pagination.all_loaded") %></p>
<% end %>
