<h1 class="mb-4">ストーリー一覧</h1>

<p>最新のインポート順に 50 件ずつ表示します。条件を指定すると一覧を絞り込めます。</p>

<%= form_with url: stories_path, method: :get, scope: :filter, local: true, class: "stories-filter" do |f| %>
  <div class="stories-filter-grid">
    <div class="stories-filter-field">
      <%= f.label :q, "キーワード" %>
      <%= f.search_field :q, value: @filter_params[:q], placeholder: "タイトル、説明を検索", class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :story_type, "タイプ" %>
      <%= f.select :story_type,
                   options_for_select(@available_story_types, @filter_params[:story_type]),
                   { include_blank: "指定なし" },
                   class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :current_state, "状態" %>
      <%= f.select :current_state,
                   options_for_select(@available_states, @filter_params[:current_state]),
                   { include_blank: "指定なし" },
                   class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :priority, "優先度" %>
      <%= f.select :priority,
                   options_for_select(@available_priorities, @filter_params[:priority]),
                   { include_blank: "指定なし" },
                   class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :labels, "ラベル" %>
      <%= f.select :labels,
                   options_for_select(@available_labels, @filter_params[:labels]),
                   {},
                   multiple: true,
                   size: 4,
                   class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :owners, "担当者" %>
      <%= f.select :owners,
                   options_for_select(@available_owners, @filter_params[:owners]),
                   {},
                   multiple: true,
                   size: 4,
                   class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :created_from, "作成日 (From)" %>
      <%= f.date_field :created_from, value: @filter_params[:created_from], class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :created_to, "作成日 (To)" %>
      <%= f.date_field :created_to, value: @filter_params[:created_to], class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :accepted_from, "受け入れ日 (From)" %>
      <%= f.date_field :accepted_from, value: @filter_params[:accepted_from], class: "stories-filter-input" %>
    </div>

    <div class="stories-filter-field">
      <%= f.label :accepted_to, "受け入れ日 (To)" %>
      <%= f.date_field :accepted_to, value: @filter_params[:accepted_to], class: "stories-filter-input" %>
    </div>
  </div>

  <div class="stories-filter-actions">
    <%= f.submit "絞り込む", class: "stories-filter-submit" %>
    <%= link_to "条件をクリア", stories_path, class: "stories-filter-reset" %>
  </div>
<% end %>

<div class="stories-layout">
  <section class="stories-list">
    <%= turbo_frame_tag "stories_list",
                         data: { controller: "infinite-scroll", action: "turbo:frame-load->infinite-scroll#reset" } do %>
      <%= render "list", stories: @stories, next_page: @next_page, filter_params: @filter_params %>
    <% end %>
  </section>

  <aside class="stories-detail">
    <%= turbo_frame_tag "story_detail" do %>
      <p class="story-detail-placeholder">
        一覧からストーリーを選択すると、ここに詳細が表示されます。
      </p>
    <% end %>
  </aside>
</div>
